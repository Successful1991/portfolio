"use strict";var scene,camera,controls,renderer,meteorite,animationCameraPosition,animationResetCameraPosition,galaxyAdd,spaceship,planets,cometLoadingIndicator=!1,t=0,infoActive=!1,indicatorHint=!1,spaceshipIndicator=!1,menu=!1,cameraPosition=!1,cameraPurposeActive=!1,mouseMove=!1,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,defaultDirectionCamera={x:0,y:0,z:0},currentDirectionCamera={x:0,y:0,z:0},defaultPositionCamera={x:0,y:3800,z:17e3},cometsConfig=[{position:{x:3600,y:3200,z:-1600},scale:2,animate:{rotation:{x:.01,y:.03},position:{z:17}}},{position:{x:-2200,y:1200,z:-3e3},scale:1,animate:{rotation:{x:.02,y:0},position:{z:12}}},{position:{x:2800,y:1900,z:-6500},scale:5,animate:{rotation:{x:.01,y:.02},position:{z:25}}},{position:{x:-2500,y:-3200,z:-13e3},scale:5,animate:{rotation:{x:.03,y:.01},position:{z:12}}},{position:{x:-2e3,y:2800,z:4e3},scale:3,animate:{rotation:{x:0,y:.03},position:{z:14}}},{position:{x:3e3,y:3800,z:500},scale:7,animate:{rotation:{x:.02,y:0},position:{z:14}}},{position:{x:2500,y:-4100,z:-1e4},scale:4,animate:{rotation:{x:0,y:.01},position:{z:30}}},{position:{x:1400,y:1300,z:-8100},scale:2,animate:{rotation:{x:.02,y:0},position:{z:17}}},{position:{x:0,y:-1500,z:-1100},scale:6,animate:{rotation:{x:.02,y:.02},position:{z:10}}},{position:{x:-3300,y:4500,z:-4e3},scale:8,animate:{rotation:{x:.03,y:0},position:{z:17}}}],galactic=[{height:17e3,width:17e3,position:{x:16e3,y:7e3,z:-92e3},rotation:0,url:"build/img/stars/galactictop.png"},{height:9e4,width:6e4,position:{x:-34e3,y:-1e4,z:-42e3},rotation:20,url:"build/img/stars/galactic2.jpg"},{height:64e3,width:64e3,position:{x:104e3,y:-5e4,z:-1e5},rotation:-1,url:"build/img/stars/atlantis_nebula-final.png"},{height:64e3,width:64e3,position:{x:104e3,y:2e4,z:-1e5},rotation:-1,url:"build/img/stars/downloaded-finish.jpg"}],starsType=[{amount:4e3,distance:5500,opacity:1,size:6,url:"build/img/stars/p_0.png"},{amount:3e3,distance:5500,opacity:.5,size:4,url:"build/img/stars/star_preview.png"},{amount:2e3,distance:5500,opacity:1,size:8,url:"build/img/stars/galactic_blur.png"},{amount:10,distance:5500,opacity:1,size:60,url:"build/img/stars/corona.png"},{amount:100,distance:5500,opacity:1,size:15,url:"build/img/stars/galactic_sharp.png"},{amount:7e3,distance:5500,opacity:1,size:1,url:!1}],newCameraPosition={newPosition:function(t,n,e,o,i,a,r){var s={gap:{x:e,y:e,z:o},shift:{x:i,y:a,z:r},animateCompleted:{x:!1,y:!1,z:!1}};if(Object.keys(t).forEach(function(e){t[e]>n[e]+s.gap[e]?t[e]-=1.3*s.shift[e]:t[e]<n[e]-s.gap.z?t[e]+=s.shift[e]:s.animateCompleted[e]=!0}),s.animateCompleted.x&&s.animateCompleted.y&&s.animateCompleted.z)return s.animateCompleted.x=!1,s.animateCompleted.y=!1,!(s.animateCompleted.z=!1)}},planetsConfig=[{name:"planet1",popupName:"aboutMe",radius:900,segment:60,url:"build/img/planet_Bog.jpg",posX:0,posY:0,posZ:-4e3},{name:"planet2",popupName:"portfolio",radius:900,segment:60,url:"build/img/Venus2.jpg",posX:-4e3,posY:0,posZ:4e3},{name:"planet3",popupName:"contact",radius:900,segment:50,url:"build/img/planet_Quom.jpg",posX:4e3,posY:0,posZ:4e3}];function init(){scene=new THREE.Scene,(camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e5)).position.set(0,3800,17e3),camera.rotation.set(0,0,0),(renderer=new THREE.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0,.5),document.getElementById("desktop").appendChild(renderer.domElement);var e=new THREE.DirectionalLight(16777215,1.2);e.position.x=22e3,e.position.y=12e3,scene.add(e);var t=new THREE.AmbientLight("#ffffff",.25);scene.add(t),addControls(),planets=planetsConfig.map(function(e){return addNewPlanet(e)}),addGalactic(galactic),addStar(starsType),addEventClosed(),loaderMeteorite(),loaderSpaceship2(),console.log(scene),animate()}function addControls(){(controls=new THREE.OrbitControls(camera)).maxDistance=38e3,controls.minDistance=10500,controls.zoomSpeed=.5,controls.rotateSpeed=.1,controls.panSpeed=.1,controls.enablePan=!1,controls.enableRotate=!0,controls.maxPolarAngle=Math.PI/2+.3,controls.minPolarAngle=Math.PI/2-.5,controls.minAzimuthAngle=-.6,controls.maxAzimuthAngle=.6}function loaderSpaceship2(){(new THREE.MTLLoader).load("build/img/intercept2/tie-intercept.mtl",function(e){e.preload();var t=new THREE.OBJLoader;t.setMaterials(e),t.setPath("build/img/"),t.load("intercept2/tie-intercept.obj",function(e){e.position.set(planets[1].position.x,planets[1].position.y,planets[1].position.z),e.scale.set(12.5,12.5,12.5),spaceship=e,scene.add(spaceship),spaceshipIndicator=!0,document.getElementById("desktop").style.left="0",document.getElementById("loader").style.left="-100vw"})})}function loaderMeteorite(){var e=new THREE.MTLLoader;e.setBaseUrl("build/img/meteorite/"),e.setPath("build/img/meteorite/");e.load("meteority_letyat.mtl",function(e){e.preload();var t=new THREE.OBJLoader;t.setMaterials(e),t.setPath("build/img/meteorite/"),t.load("meteority_letyat.obj",function(n){meteorite=cometsConfig.map(function(e){var t=n.clone();return console.log(t),t.position.set(e.position.x,e.position.y,e.position.z),t.scale.set(e.scale,e.scale,e.scale),scene.add(t),t}),cometLoadingIndicator=!0})})}function addStar(e){e.forEach(function(e){var t=new THREE.Geometry,n=new THREE.PointsMaterial({color:16777215,opacity:e.opacity,size:e.size,blending:THREE.AdditiveBlending,sizeAttenuation:!1,depthWrite:!1,transparent:!0});e.url&&(n.map=(new THREE.TextureLoader).load(e.url));for(var o=0;o<e.amount;o++){var i=new THREE.Vector3;i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),i.multiplyScalar(e.distance),t.vertices.push(i)}(e=new THREE.Points(t,n)).scale.set(30,30,30),scene.add(e)})}function addNewPlanet(e){var t=new THREE.SphereGeometry(e.radius,e.segment,e.segment),n=new THREE.MeshLambertMaterial({map:(new THREE.TextureLoader).load(e.url),side:THREE.FrontSide}),o=new THREE.Mesh(t,n);return o.position.set(e.posX,e.posY,e.posZ),o.rotation.x=90,o.name=e.name,o.popupName=e.popupName,scene.add(o),o}function rotateAroundWorldAxis(e,t,n){var o=new THREE.Matrix4;o.makeRotationAxis(t.normalize(),n);var i=new THREE.Vector4(e.position.x,e.position.y,e.position.z,1).applyMatrix4(o);o.multiply(e.matrix),e.matrix=o,e.rotation.setFromRotationMatrix(e.matrix),e.position.set(i.x,i.y,i.z)}function returnCometsPosition(e){return e.position.z<=-12e3||18e3<=e.position.z?-12e3:e.position.z}function addGalactic(e){galaxyAdd=e.map(function(e){var t=new THREE.PlaneGeometry(e.height,e.width,1),n=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.url),blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0}),o=new THREE.Mesh(t,n);return o.position.set(e.position.x,e.position.y,e.position.z),scene.add(o),o})}function hideTooltips(){planets.forEach(function(e){document.getElementById(e.popupName).style.visibility="hidden"})}function renderClick(e){hideTooltips(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var t=raycaster.intersectObjects(scene.children);planets.forEach(function(e){0<t.length&&t[0].object.name===e.name&&!infoActive&&(clickMenuItem(e.name),movementToThePlanet(e))}),renderer.render(scene,camera)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(e){mouseMove||(mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,renderMouseMove())}function renderMouseMove(){raycaster.setFromCamera(mouse,camera);var t=raycaster.intersectObjects(scene.children);indicatorHint||infoActive?(0===t.length||t[0].object.name!==planets[0].name&&t[0].object.name!==planets[1].name&&t[0].object.name!==planets[2].name)&&(hideTooltips(),indicatorHint=!1):planets.forEach(function(e){0<t.length&&t[0].object.name===e.name&&!infoActive&&(indicatorHint=!0,document.getElementById(e.popupName).style.visibility="visible")}),renderer.render(scene,camera)}function movementToThePlanet(e){var t=e,n=1.5*t.geometry.parameters.radius,o={x:t.position.z<camera.position.z?t.position.x+n:t.position.x-n,y:t.position.y,z:t.position.z};!function e(){cameraPosition&&cameraPurposeActive?cancelAnimationFrame(animationCameraPosition):(cameraPurpose(currentDirectionCamera,o),cameraPosition=newCameraPosition.newPosition(camera.position,t.position,1100,5e3,80,110,200),animationCameraPosition=requestAnimationFrame(e))}()}function resetCameraPosition(){cameraPosition&&cameraPurposeActive?(mouseMove=!1,cancelAnimationFrame(animationResetCameraPosition)):(cameraPurpose(currentDirectionCamera,defaultDirectionCamera),cameraPosition=newCameraPosition.newPosition(camera.position,defaultPositionCamera,100,200,50,60,120),animationResetCameraPosition=requestAnimationFrame(resetCameraPosition))}function cameraPurpose(e,t){cameraPurposeActive=newCameraPosition.newPosition(e,t,240,240,50,60,120),camera.lookAt(e.x,e.y,e.z)}function getIdClick(e){var n=e.target.getAttribute("data-planet");planets.forEach(function(e){var t=document.getElementById(e.name).classList.contains("infoActive");n!==e.name||t||(clickMenuItem(e.name),movementToThePlanet(e))})}function clickMenuItem(e){mouseMove=!0,removeClassActive(),resetVariableInfo(),controls.dispose(),openInfo(e),infoActive=!0}function resetVariableInfo(){cameraPurposeActive=cameraPosition=infoActive=!1}function addEventClosed(){for(var e=document.querySelectorAll(".closed"),t=0;t<e.length;t++)e[t].addEventListener("click",closedInfo)}function openMenu(){var n=document.querySelector("#menu > input").checked;document.querySelectorAll(".menu__item").forEach(function(e,t){n?(e.style.animation="menuAnimate 1s forwards "+t/2+"s",menu=!0):(e.style.animation="menuDefault 1s forwards",menu=!1)})}function openInfo(e){document.getElementById(e)&&document.getElementById(e).classList.add("infoActive")}function closedInfo(){removeClassActive(),setTimeout(function(){resetVariableInfo(),resetCameraPosition(),addControls()},1e3)}function removeClassActive(){0<document.querySelectorAll(".infoActive").length&&(document.querySelector(".infoActive").classList.add("infoClose"),document.querySelector(".infoActive").classList.remove("infoActive"),setTimeout(function(){document.querySelector(".infoClose").classList.remove("infoClose")},2e3))}function animate(){requestAnimationFrame(animate),infoActive||indicatorHint?infoActive&&(controls.enableRotate=!1):(rotateAroundWorldAxis(planets[0],new THREE.Vector3(0,1,0),.001),rotateAroundWorldAxis(planets[1],new THREE.Vector3(0,1,0),.001),rotateAroundWorldAxis(planets[2],new THREE.Vector3(0,1,0),.001),controls.update()),cometLoadingIndicator&&meteorite.forEach(function(e,t){e.position.z=returnCometsPosition(e),e.position.z+=cometsConfig[t].animate.position.z,e.rotation.x+=cometsConfig[t].animate.rotation.x,e.rotation.y+=cometsConfig[t].animate.rotation.y}),planets[0].rotation.y-=.001,planets[1].rotation.y+=.001,planets[2].rotation.y+=.001,galaxyAdd[0].rotation.z+=5e-4,spaceshipIndicator&&(spaceship.position.x=100*Math.sin(.15*t)+planets[1].position.x,spaceship.position.z=100*Math.cos(.15*t)+planets[1].position.z,spaceship.rotation.x-=.005,spaceship.rotation.y-=.005),t+=Math.PI/180*2,renderer.render(scene,camera)}window.addEventListener("resize",onWindowResize,!1),document.querySelector("canvas").addEventListener("mousemove",onDocumentMouseMove),document.querySelector("canvas").addEventListener("click",renderClick),document.getElementById("burger").addEventListener("click",openMenu),document.getElementById("menu__list").addEventListener("click",getIdClick),window.addEventListener("load",function(){init()});