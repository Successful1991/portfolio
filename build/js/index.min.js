"use strict";window.addEventListener("load",function(){var a,o,n,i,s,r,e,t,p,m,c,l=!1,d=0,u=!1,y=!1,E=!1,g=!1,f=!1,h=!1,w=new THREE.Raycaster,z=new THREE.Vector2,x={x:0,y:0,z:0},v={x:0,y:0,z:0},T={x:0,y:3800,z:17e3},H=[{position:{x:3600,y:3200,z:-1600},scale:40,animate:{rotation:{x:.01,y:.03},position:{z:10}}},{position:{x:-2200,y:1200,z:-3e3},scale:50,animate:{rotation:{x:.02,y:0},position:{z:12}}},{position:{x:2800,y:1900,z:-6500},scale:40,animate:{rotation:{x:.01,y:.02},position:{z:25}}},{position:{x:-2500,y:-3200,z:-13e3},scale:55,animate:{rotation:{x:.03,y:.01},position:{z:8}}},{position:{x:-2e3,y:2800,z:4e3},scale:30,animate:{rotation:{x:0,y:.03},position:{z:9}}},{position:{x:3e3,y:3800,z:500},scale:40,animate:{rotation:{x:.02,y:0},position:{z:14}}},{position:{x:2500,y:-4100,z:-1e4},scale:54,animate:{rotation:{x:0,y:.01},position:{z:13}}},{position:{x:1400,y:1300,z:-8100},scale:40,animate:{rotation:{x:.02,y:0},position:{z:17}}},{position:{x:0,y:-1500,z:-1100},scale:45,animate:{rotation:{x:.02,y:.02},position:{z:10}}},{position:{x:-3300,y:4500,z:-4e3},scale:35,animate:{rotation:{x:.03,y:0},position:{z:17}}}],R={newPosition:function(t,n,e,i,o,a,s){var r={gap:{x:e,y:e,z:i},shift:{x:o,y:a,z:s},animateCompleted:{x:!1,y:!1,z:!1}};if(Object.keys(t).forEach(function(e){t[e]>n[e]+r.gap[e]?t[e]-=1.3*r.shift[e]:t[e]<n[e]-r.gap.z?t[e]+=r.shift[e]:r.animateCompleted[e]=!0}),r.animateCompleted.x&&r.animateCompleted.y&&r.animateCompleted.z)return r.animateCompleted.x=!1,r.animateCompleted.y=!1,!(r.animateCompleted.z=!1)}};function A(){(n=new THREE.OrbitControls(o)).maxDistance=38e3,n.minDistance=10500,n.zoomSpeed=.5,n.rotateSpeed=.1,n.panSpeed=.1,n.enablePan=!1,n.enableRotate=!0,n.maxPolarAngle=Math.PI/2+.3,n.minPolarAngle=Math.PI/2-.5,n.minAzimuthAngle=-.6,n.maxAzimuthAngle=.6}function b(e,t,n){var i=new THREE.Matrix4;i.makeRotationAxis(t.normalize(),n);var o=new THREE.Vector4(e.position.x,e.position.y,e.position.z,1).applyMatrix4(i);i.multiply(e.matrix),e.matrix=i,e.rotation.setFromRotationMatrix(e.matrix),e.position.set(o.x,o.y,o.z)}function L(){m.forEach(function(e){document.getElementById(e.popupName).style.visibility="hidden"})}function M(e){var t=e,n=1.5*t.geometry.parameters.radius,i={x:t.position.z<o.position.z?t.position.x+n:t.position.x-n,y:t.position.y,z:t.position.z};!function e(){g&&f?cancelAnimationFrame(r):(P(v,i),g=R.newPosition(o.position,t.position,1100,5e3,80,110,200),r=requestAnimationFrame(e))}()}function C(){g&&f?(h=!1,cancelAnimationFrame(e)):(P(v,x),g=R.newPosition(o.position,T,100,200,50,60,120),e=requestAnimationFrame(C))}function P(e,t){f=R.newPosition(e,t,240,240,50,60,120),o.lookAt(e.x,e.y,e.z)}function S(e){var t;h=!0,I(),B(),n.dispose(),t=e,document.getElementById(t)&&document.getElementById(t).classList.add("infoActive"),u=!0}function B(){f=g=u=!1}function j(){I(),setTimeout(function(){B(),C(),A()},1e3)}function I(){0<document.querySelectorAll(".infoActive").length&&(document.querySelector(".infoActive").classList.add("infoClose"),document.querySelector(".infoActive").classList.remove("infoActive"),setTimeout(function(){document.querySelector(".infoClose").classList.remove("infoClose")},2e3))}!function(){a=new THREE.Scene,(o=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e5)).position.set(0,3800,17e3),o.rotation.set(0,0,0),(i=new THREE.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),i.setClearColor(0,.5),document.getElementById("desktop").appendChild(i.domElement);var e=new THREE.DirectionalLight(16777215,1.2);e.position.x=22e3,e.position.y=12e3,a.add(e);var t=new THREE.AmbientLight("#ffffff",.25);a.add(t),A(),console.log(a)}(),m=[{name:"planet1",popupName:"aboutMe",radius:900,segment:60,url:"app/img/planet_Bog.jpg",posX:0,posY:0,posZ:-4e3},{name:"planet2",popupName:"portfolio",radius:900,segment:60,url:"app/img/Venus2.jpg",posX:-4e3,posY:0,posZ:4e3},{name:"planet3",popupName:"contact",radius:900,segment:50,url:"app/img/planet_Quom.jpg",posX:4e3,posY:0,posZ:4e3}].map(function(e){return t=e,n=new THREE.SphereGeometry(t.radius,t.segment,t.segment),i=new THREE.MeshLambertMaterial({map:(new THREE.TextureLoader).load(t.url),side:THREE.FrontSide}),(o=new THREE.Mesh(n,i)).position.set(t.posX,t.posY,t.posZ),o.rotation.x=90,o.name=t.name,o.popupName=t.popupName,a.add(o),o;var t,n,i,o}),window.addEventListener("resize",function(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)},!1),document.querySelector("canvas").addEventListener("mousemove",function(e){h||(z.x=e.clientX/window.innerWidth*2-1,z.y=-e.clientY/window.innerHeight*2+1,function(){w.setFromCamera(z,o);var t=w.intersectObjects(a.children);y||u?(0===t.length||t[0].object.name!==m[0].name&&t[0].object.name!==m[1].name&&t[0].object.name!==m[2].name)&&(L(),y=!1):m.forEach(function(e){0<t.length&&t[0].object.name===e.name&&!u&&(y=!0,document.getElementById(e.popupName).style.visibility="visible")}),i.render(a,o)}())}),document.querySelector("canvas").addEventListener("click",function(e){L(),z.x=e.clientX/window.innerWidth*2-1,z.y=-e.clientY/window.innerHeight*2+1,w.setFromCamera(z,o);var t=w.intersectObjects(a.children);m.forEach(function(e){0<t.length&&t[0].object.name===e.name&&!u&&(S(e.name),M(e))}),i.render(a,o)}),document.getElementById("burger").addEventListener("click",function(){var n=document.querySelector("#menu > input").checked;document.querySelectorAll(".menu__item").forEach(function(e,t){n?(e.style.animation="menuAnimate 1s forwards "+t/2+"s",!0):(e.style.animation="menuDefault 1s forwards",!1)})}),document.getElementById("menu__list").addEventListener("click",function(e){var n=e.target.getAttribute("data-planet");m.forEach(function(e){var t=document.getElementById(e.name).classList.contains("infoActive");n!==e.name||t||(S(e.name),M(e))})}),t=[{height:17e3,width:17e3,position:{x:16e3,y:7e3,z:-92e3},rotation:0,url:"app/img/stars/galactictop.png"},{height:9e4,width:6e4,position:{x:-34e3,y:-1e4,z:-42e3},rotation:20,url:"app/img/stars/galactic2.jpg"},{height:64e3,width:64e3,position:{x:104e3,y:-5e4,z:-1e5},rotation:-1,url:"app/img/stars/atlantis_nebula-final.png"},{height:64e3,width:64e3,position:{x:104e3,y:2e4,z:-1e5},rotation:-1,url:"app/img/stars/downloaded-finish.jpg"}].map(function(e){var t=new THREE.PlaneGeometry(e.height,e.width,1),n=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.url),blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0}),i=new THREE.Mesh(t,n);return i.position.set(e.position.x,e.position.y,e.position.z),a.add(i),i}),[{amount:4e3,distance:5500,opacity:1,size:6,url:"app/img/stars/p_0.png"},{amount:3e3,distance:5500,opacity:.5,size:4,url:"app/img/stars/star_preview.png"},{amount:2e3,distance:5500,opacity:1,size:8,url:"app/img/stars/galactic_blur.png"},{amount:10,distance:5500,opacity:1,size:60,url:"app/img/stars/corona.png"},{amount:100,distance:5500,opacity:1,size:15,url:"app/img/stars/galactic_sharp.png"},{amount:7e3,distance:5500,opacity:1,size:1,url:!1}].forEach(function(e){var t=new THREE.Geometry,n=new THREE.PointsMaterial({color:16777215,opacity:e.opacity,size:e.size,blending:THREE.AdditiveBlending,sizeAttenuation:!1,depthWrite:!1,transparent:!0});e.url&&(n.map=(new THREE.TextureLoader).load(e.url));for(var i=0;i<e.amount;i++){var o=new THREE.Vector3;o.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),o.multiplyScalar(e.distance),t.vertices.push(o)}(e=new THREE.Points(t,n)).scale.set(30,30,30),a.add(e)}),function(){for(var e=document.querySelectorAll(".closed"),t=0;t<e.length;t++)e[t].addEventListener("click",j)}(),(c=new THREE.MTLLoader).setBaseUrl("app/img/meteorite/"),c.setPath("app/img/meteorite/"),c.load("meteority_letyat.mtl",function(e){e.preload();var t=new THREE.OBJLoader;t.setMaterials(e),t.setPath("app/img/meteorite/"),t.load("meteority_letyat.obj",function(n){s=H.map(function(e,t){return(e=n.clone()).position.set(H[t].position.x,H[t].position.y,H[t].position.z),e.scale=H[t].scale,a.add(e),e}),l=!0})}),(new THREE.MTLLoader).load("app/img/intercept2/tie-intercept.mtl",function(e){e.preload();var t=new THREE.OBJLoader;t.setMaterials(e),t.setPath("app/img/"),t.load("intercept2/tie-intercept.obj",function(e){e.position.set(m[1].position.x,m[1].position.y,m[1].position.z),e.scale.set(12.5,12.5,12.5),p=e,a.add(p),E=!0,document.getElementById("desktop").style.left="0",document.getElementById("loader").style.left="-100vw"})}),function e(){requestAnimationFrame(e),u||y?u&&(n.enableRotate=!1):(b(m[0],new THREE.Vector3(0,1,0),.001),b(m[1],new THREE.Vector3(0,1,0),.001),b(m[2],new THREE.Vector3(0,1,0),.001),n.update()),l&&s.forEach(function(e,t){var n;e.position.z=(n=e).position.z<=-12e3||18e3<=n.position.z?-12e3:n.position.z,e.position.z+=H[t].animate.position.z,e.rotation.x+=H[t].animate.rotation.x,e.rotation.y+=H[t].animate.rotation.y}),m[0].rotation.y-=.001,m[1].rotation.y+=.001,m[2].rotation.y+=.001,t[0].rotation.z+=5e-4,E&&(p.position.x=100*Math.sin(.15*d)+m[1].position.x,p.position.z=100*Math.cos(.15*d)+m[1].position.z,p.rotation.x-=.005,p.rotation.y-=.005),d+=Math.PI/180*2,i.render(a,o)}()});